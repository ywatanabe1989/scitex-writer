%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#e3f2fd','primaryTextColor':'#000','primaryBorderColor':'#1976d2','lineColor':'#424242','secondaryColor':'#f3e5f5','tertiaryColor':'#fff3e0'}}}%%
graph TB
    User[ğŸ‘¤ User Interface<br/>Shell Scripts] --> Config[âš™ï¸ Configuration Layer<br/>YAML Settings]

    Config --> Pipeline[ğŸ”„ Preprocessing Pipeline]

    Pipeline --> BibMerge[ğŸ“š Bibliography Merger<br/>Multi-file + Dedup]
    Pipeline --> FigProc[ğŸ–¼ï¸ Figure Processor<br/>Format Conversion]
    Pipeline --> TabProc[ğŸ“Š Table Processor<br/>CSV to LaTeX]

    BibMerge --> EngineSelect{ğŸ¯ Engine Selection<br/>Auto-detect}
    FigProc --> EngineSelect
    TabProc --> EngineSelect

    EngineSelect -->|Fast| Tectonic[âš¡ Tectonic<br/>1-3s]
    EngineSelect -->|Standard| Latexmk[ğŸ”§ latexmk<br/>3-6s]
    EngineSelect -->|Compatible| ThreePass[ğŸ”’ 3-pass<br/>12-18s]

    Tectonic --> PostProc[ğŸ“ Post-Processing]
    Latexmk --> PostProc
    ThreePass --> PostProc

    PostProc --> DiffGen[ğŸ“‹ Diff Generator<br/>latexdiff]
    PostProc --> WordCount[ğŸ“ˆ Word Counter]
    PostProc --> Archive[ğŸ’¾ Version Archive]

    DiffGen --> Output[ğŸ“„ Output PDFs<br/>Main + Diff]
    WordCount --> Output
    Archive --> Output

    style User fill:#4caf50,stroke:#2e7d32,stroke-width:2px,color:#fff
    style Config fill:#ff9800,stroke:#e65100,stroke-width:2px,color:#fff
    style Pipeline fill:#2196f3,stroke:#1565c0,stroke-width:2px,color:#fff
    style EngineSelect fill:#9c27b0,stroke:#6a1b9a,stroke-width:2px,color:#fff
    style Output fill:#4caf50,stroke:#2e7d32,stroke-width:2px,color:#fff
