#!/bin/bash
# -*- coding: utf-8 -*-
# Timestamp: "2025-11-12 (ywatanabe)"
# File: ./config/version_control.conf
# Description: Configuration for Git-based version control and archive management

# ============================================================================
# Git Auto-Commit Settings
# ============================================================================

# Enable/disable automatic git commits after successful compilation
# Set to "true" to auto-commit, "false" to disable
GIT_AUTO_COMMIT_ENABLED=${GIT_AUTO_COMMIT_ENABLED:-true}

# Commit message template
# Available placeholders: %DOC_TYPE%, %VERSION%
GIT_COMMIT_MESSAGE_TEMPLATE="chore: Auto-archive %DOC_TYPE% %VERSION%"

# Enable/disable automatic git tagging
# Tags will be created as: {DOC_TYPE}-{VERSION} (e.g., manuscript-v113)
GIT_TAG_ENABLED=${GIT_TAG_ENABLED:-true}

# Tag prefix template
# Available placeholders: %DOC_TYPE%
GIT_TAG_PREFIX="%DOC_TYPE%-"

# Enable/disable automatic git push (default: false for safety)
# WARNING: Only enable if you want to automatically push to remote
GIT_PUSH_ENABLED=${GIT_PUSH_ENABLED:-false}

# Remote name to push to (default: origin)
GIT_PUSH_REMOTE=${GIT_PUSH_REMOTE:-origin}

# Branch to push to (default: current branch)
GIT_PUSH_BRANCH=${GIT_PUSH_BRANCH:-}

# ============================================================================
# Archive Cleanup Settings
# ============================================================================

# Enable/disable automatic cleanup of old archive versions
# Set to "true" to keep only recent N versions, "false" to keep all
ARCHIVE_CLEANUP_ENABLED=${ARCHIVE_CLEANUP_ENABLED:-true}

# Number of recent versions to keep in archive directory
# Older versions will be deleted (but preserved in git history)
# Default: 20 versions
ARCHIVE_KEEP_LAST_N=${ARCHIVE_KEEP_LAST_N:-20}

# Minimum number of versions to keep (safety threshold)
# Cleanup will NOT run if total versions < this number
# Default: 5 versions
ARCHIVE_MIN_KEEP=${ARCHIVE_MIN_KEEP:-5}

# ============================================================================
# Fallback & Error Handling
# ============================================================================

# Fail compilation if git operations fail
# false = continue even if git fails (recommended)
# true = abort compilation on git errors
FAIL_ON_GIT_ERROR=${FAIL_ON_GIT_ERROR:-false}

# Log all git operations to compilation log
LOG_GIT_OPERATIONS=${LOG_GIT_OPERATIONS:-true}

# ============================================================================
# Advanced Settings
# ============================================================================

# Atomic commit behavior:
# Commits ONLY the specific files created/modified by this compilation:
#   1. The 4 archived files for this version (PDF, TeX, diff PDF, diff TeX)
#   2. The version counter file
#   3. Cleanup history (if cleanup ran)
# NO other files are staged or committed - ensures minimal, atomic commits

# Git commit author override (leave empty to use git config)
GIT_COMMIT_AUTHOR_NAME=${GIT_COMMIT_AUTHOR_NAME:-}
GIT_COMMIT_AUTHOR_EMAIL=${GIT_COMMIT_AUTHOR_EMAIL:-}

# ============================================================================
# Export all settings
# ============================================================================

export GIT_AUTO_COMMIT_ENABLED
export GIT_COMMIT_MESSAGE_TEMPLATE
export GIT_TAG_ENABLED
export GIT_TAG_PREFIX
export GIT_PUSH_ENABLED
export GIT_PUSH_REMOTE
export GIT_PUSH_BRANCH
export ARCHIVE_CLEANUP_ENABLED
export ARCHIVE_KEEP_LAST_N
export ARCHIVE_MIN_KEEP
export FAIL_ON_GIT_ERROR
export LOG_GIT_OPERATIONS
export GIT_COMMIT_AUTHOR_NAME
export GIT_COMMIT_AUTHOR_EMAIL

# EOF
