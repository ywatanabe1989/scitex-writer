#!/bin/bash
# -*- coding: utf-8 -*-
# Time-stamp: "2025-09-27 15:00:00 (ywatanabe)"
# File: ./compile

################################################################################
# Unified compilation interface
# Delegates to specific compilation scripts based on document type
################################################################################

# Default values
DOC_TYPE=""
SHOW_HELP=false

# Function to display usage
show_usage() {
    cat << EOF
Usage: ./compile [TYPE] [OPTIONS]

Unified compilation interface for scientific documents.

DOCUMENT TYPES:
    manuscript, -m        Compile manuscript (default if no type specified)
    supplementary, -s     Compile supplementary materials
    revision, -r          Compile revision responses

GLOBAL OPTIONS:
    -h, --help           Show this help message

TYPE-SPECIFIC OPTIONS:
    Pass any additional options after the document type.
    These will be forwarded to the specific compilation script.

EXAMPLES:
    ./compile                           # Compile manuscript (default)
    ./compile manuscript                # Explicitly compile manuscript
    ./compile supplementary             # Compile supplementary materials
    ./compile revision --track-changes  # Compile revision with track changes

    Short forms:
    ./compile -m                        # Compile manuscript
    ./compile -s                        # Compile supplementary
    ./compile -r --track-changes        # Compile revision with options

DELEGATION:
    This script delegates to:
    - ./scripts/shell/compile_manuscript for manuscripts
    - ./scripts/shell/compile_supplementary for supplementary materials
    - ./scripts/shell/compile_revision for revision responses

    Each specific script has its own options and behaviors.

EOF
}

# Parse first argument to determine document type
if [ $# -eq 0 ]; then
    DOC_TYPE="manuscript"
else
    case $1 in
        manuscript|-m)
            DOC_TYPE="manuscript"
            shift
            ;;
        supplementary|-s)
            DOC_TYPE="supplementary"
            shift
            ;;
        revision|-r)
            DOC_TYPE="revision"
            shift
            ;;
        -h|--help)
            show_usage
            exit 0
            ;;
        *)
            echo "ERROR: Unknown document type '$1'"
            echo "Valid types: manuscript, supplementary, revision"
            echo "Use './compile --help' for usage information"
            exit 1
            ;;
    esac
fi

# Display what we're doing
echo "=========================================="
echo "Compilation Interface"
echo "  Document type: $DOC_TYPE"
if [ $# -gt 0 ]; then
    echo "  Additional options: $@"
fi
echo "  Delegating to: ./scripts/shell/compile_$DOC_TYPE.sh"
echo "=========================================="

# Delegate to the appropriate compilation script
case $DOC_TYPE in
    manuscript)
        ./scripts/shell/compile_manuscript.sh "$@"
        ;;
    supplementary)
        ./scripts/shell/compile_supplementary.sh "$@"
        ;;
    revision)
        ./scripts/shell/compile_revision.sh "$@"
        ;;
    *)
        echo "Error: Unknown document type: $DOC_TYPE"
        exit 1
        ;;
esac

# Exit with the same status as the delegated script
exit $?
